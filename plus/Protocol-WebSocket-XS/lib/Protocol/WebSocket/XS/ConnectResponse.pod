=head1 NAME

Protocol::WebSocket::XS::ConnectResponse - Server HTTP response for websocket connection request

=cut

=head1 SYNOPSIS

    use Protocol::WebSocket::XS::ConnectResponse;

    my $response = Protocol::WebSocket::XS::ConnectResponse->new({
        code          => '404',
        message       => 'Not Found',
        body          => '...',
        headers       => { 'Cache-Control' => 'no-cache'},
        ws_protocol   => "chat",
        ws_extensions => [["ext1"], ["ext2", {arg1 => 1}]],
    }); # => isa 'Protocol::HTTP::Response'

    $response->ws_protocol;                          # => 'chat'
    $response->ws_protocol('bla-bla');
    $response->ws_protocol;                          # => 'bla-bla'

    $response->ws_extensions;                        # => is_deeply ([["ext1"], ["ext2", {arg1 => 1}]])
    $response->ws_extensions([]);
    $response->ws_extensions;                        # => is_deeply([])


=head1 DESCRIPTION

Extends base class L<Protocol::HTTP::Response> with websocket-related
details, namely (in case of successfully established connection):

1. Hard-coded headers, code and message, required by L<Protocol::WebSocket::XS>, e.g.
C<101 Switching Protocols>.

2. User-defined websocket headers, e.g. C<Sec-WebSocket-Protocol>.

3. Selected subset of server-supported extensions and their options, initially proposed
by client in the request if they match server-configuration, e.g.
C<Sec-WebSocket-Extensions>

3. User-supplied custom headers, if needed.

=head1 METHODS

=head2 new(\%params)

Additional params on top of C<Protocol::HTTP::Response>'s C<new> method.

=over 2

=item ws_protocol ($string)

Identifies application specific communication protocol.

See L<rfc6455|https://tools.ietf.org/html/rfc6455> (look for C<Sec-WebSocket-Protocol>).

=item ws_extensions([\@extensions])

Additional extensions and their options, which has been offered by client-side
and server-side aggrees to use. The extensions, which are provided
by the module and enabled by user (default), will be added automatically by
L<Protocol::WebSocket::XS::ServerParser>.

User-supplied extensions wasn't tested yet, but it should be possible to let them work
at L<Protocol::WebSocket::XS::Frame> or L<Protocol::WebSocket::XS::Message> level.

=back

=head2 ws_accept_key([$string])

Getter and setter for the key hash, i.e. C<Sec-WebSocket-Accept> header.

=head2 ws_version()

Returns value of C<Sec-WebSocket-Version> header in response.

=head2 ws_extensions([@extensions])

Getter and setter for the available websocket extensions in the response.
Currently only C<permessage-deflate> is supported.

    $response->(['permessage-deflate', { 'client_max_window_bits' => '15' }]);

See L<Protocol::WebSocket::XS::Parser> for all available deflate options.

=head2 ws_protocol([$string])

Getter and setter for the websocket protocol identity (i.e.
C<Sec-WebSocket-Protocol> header).

=head2 error()

L<XS::STL::ErrorCode> object which represents Perl API for convenient
C++ C<std::error_code> subsystem. Possible errors are described in
L<Protocol::HTTP::errc>, L<Protocol::WebSocket::XS::errc>.

    if ($response->error) {
        # handle it
    }


=head1 REFERENCE

L<Protocol::WebSocket::XS>

L<Protocol::WebSocket::XS::ConnectRequest>

L<Protocol::WebSocket::XS::ClientParser>

L<Protocol::WebSocket::XS::HTTPRequest>

L<Protocol::WebSocket::XS::ServerParser>

=head1 SEE ALSO

L<rfc6455|https://tools.ietf.org/html/rfc6455>


=cut
